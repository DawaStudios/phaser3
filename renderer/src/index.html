<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Renderer Test Bed</title>
    <style>
        body {
            margin: 0;
            background: #111;
            border: none;
        }

        #gui {
            position: absolute;
            top: 200px;
            right: 0;
        }
    </style>

    <!-- useful stuff -->
    <script type="text/javascript" src="dat.gui.js"></script>
    <script type="text/javascript" src="stats.js"></script>

    <!-- system control and drawing -->
    <script type="text/javascript" src="pbRenderer.js"></script>
    <script type="text/javascript" src="pbRootTimer.js"></script>
    <script type="text/javascript" src="pbLoader.js"></script>
    <script type="text/javascript" src="pbBaseGraphics.js"></script>
    <script type="text/javascript" src="pbWebGl.js"></script>
    <script type="text/javascript" src="pbWebGlShaders.js"></script>
    <script type="text/javascript" src="pbWebGlTextures.js"></script>
    <script type="text/javascript" src="pbCanvas.js"></script>

    <!-- logic -->
    <script type="text/javascript" src="pbSprite.js"></script>
    <script type="text/javascript" src="pbSurface.js"></script>
    <script type="text/javascript" src="pbSimpleLayer.js"></script>
    <script type="text/javascript" src="pbBaseLayer.js"></script>
    <script type="text/javascript" src="pbCanvasLayer.js"></script>
    <script type="text/javascript" src="pbWebGlLayer.js"></script>
    <script type="text/javascript" src="pbBaseImage.js"></script>
    <script type="text/javascript" src="pbCanvasImage.js"></script>
    <script type="text/javascript" src="pbWebGlImage.js"></script>
    
    <!-- special purpose -->
    <script type="text/javascript" src="pbText.js"></script>
    
    <!-- data helpers -->
    <script type="text/javascript" src="pbMatrix3.js"></script>
    <script type="text/javascript" src="pbRectangle.js"></script>
    <script type="text/javascript" src="pbDictionary.js"></script>

    <!-- demos -->
    <script type="text/javascript" src="pbSoldierDemo.js"></script>
    <script type="text/javascript" src="pbTransformDemo.js"></script>
    <script type="text/javascript" src="pbWobbleDemo.js"></script>
    <script type="text/javascript" src="pbAutoInvaderDemo.js"></script>
    <script type="text/javascript" src="pbInvaderDemoCore.js"></script>
    <script type="text/javascript" src="pbTextSpriteDemo.js"></script>
    <script type="text/javascript" src="pbBunnyDemo.js"></script>
    <script type="text/javascript" src="pbBunnyDemoNPOT.js"></script>
    <script type="text/javascript" src="pbBunnyPointDemo.js"></script>
    <script type="text/javascript" src="pbBunnyPointAnimDemo.js"></script>
    <script type="text/javascript" src="pbMultiInstanceDemo.js"></script>
    <script type="text/javascript" src="pbScrollDemo.js"></script>
    <script type="text/javascript" src="pbScrollPointSpriteDemo.js"></script>
    <script type="text/javascript" src="pbCanvasToGlDemo.js"></script>
    <script type="text/javascript" src="pbGlToCanvasDemo.js"></script>

</head>

<body>

    <!-- canvas id="renderer-test" style="border: none;" width="800" height="600"></canvas -->
    <div id="gui"></div>

<script type="text/javascript">

/**
 * NOTE: use of the 'pb' prefix on all classes in this test bed is essential for renaming class references without ambiguity.
 * During development it is expected that class names, hierarchies and inter-relationships will change frequently as we grow towards the final structure.
 */

    // globals
    var demo;
    var demoName;
    var docId = 'renderer-test';
    var demoName = null;
    var useRenderer = 'canvas';             // which renderer will the demos use today?  valid values: undefined, 'webgl', 'canvas'  Switchable by dat.GUI pickRenderer widget.
    var layerClass = pbCanvasLayer;         // TODO: consider making a FunctionManager class to handle switchable classes and functions like this more tidily
    var imageClass = pbCanvasImage;
    
    
    // after reading: http://www.sitepoint.com/google-closure-how-not-to-write-javascript/
    var _undefinedCheck;
    if (undefined !== _undefinedCheck)
    {
        alert("'undefined' has been redefined which will screw up this script.");
    }

    // fps counter
    var stats = null;
    stats = new Stats();
    stats.setMode(0);
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.right = '0px';
    stats.domElement.style.bottom = '0px';
    document.body.appendChild( stats.domElement );

    // dat.GUI user interface components
    var gui = new dat.GUI({ autoPlace: false });

    var guiContainer = document.getElementById('gui');
    guiContainer.appendChild(gui.domElement);

    // let the user select a rendering mode, listen to see if the demos change the selection
    var pickRenderer = gui.add(this, "useRenderer",
        {
            webgl: "webgl",
            canvas: "canvas"
        }
    ).listen();
    pickRenderer.onFinishChange(
        function(value)
        {
            console.log("\nChanging renderer mode...", value);

            // destroy any running demo, which should also destroy the renderer it created
            if (demo)
            {
                demo.destroy();
                demo = null;
            }

            // start the same demo again
            if (demoName && window[demoName])
            {
                demo = new window[demoName](docId);
            }
        }
    );


    // let the user select a demo to view
    var pickDemo = gui.add(this, "demoName",
        {
            none: null,
            soldiers: "pbSoldierDemo",
            transforms: "pbTransformDemo",
            wobble: "pbWobbleDemo",
            invader: "pbAutoInvaderDemo",
            text: "pbTextSpriteDemo",
            instances: "pbMultiInstanceDemo",
            scroll: "pbScrollDemo",
            scrollPoint: "pbScrollPointSpriteDemo",
            canvasToGl: "pbCanvasToGlDemo",
            glToCanvas: "pbGlToCanvasDemo",
            bunny: "pbBunnyDemo",
            bunnyNPOT: "pbBunnyDemoNPOT",
            bunnyPoint: "pbBunnyPointDemo",
            bunnyPointAnim: "pbBunnyPointAnimDemo"
        }
    );
    pickDemo.onFinishChange(
        function(value)
        {
            console.log("Changing demo...", value);

            if (demo)
            {
                demo.destroy();
                demo = null;
            }

            if (value && window[value])
            {
                demo = new window[value](docId);
            }

            // remember the selected demo name
            demoName = value;
        }
    );


</script>

</body>
</html>
